
const leds = [
  {
    "id": "DA1",
    "x": 128.57,
    "y": -73.72
  },
  {
    "id": "DA2",
    "x": 125.195,
    "y": -73.72
  },
  {
    "id": "DA3",
    "x": 121.82,
    "y": -73.72
  },
  {
    "id": "DA4",
    "x": 118.47,
    "y": -75.25
  },
  {
    "id": "DA5",
    "x": 115.2,
    "y": -76.97
  },
  {
    "id": "DA6",
    "x": 111.05,
    "y": -76.97
  },
  {
    "id": "DA7",
    "x": 107.48,
    "y": -76.97
  },
  {
    "id": "DA8",
    "x": 104.225,
    "y": -76.97
  },
  {
    "id": "DA9",
    "x": 100.97,
    "y": -76.97
  },
  {
    "id": "DA10",
    "x": 96.03,
    "y": -78.43
  },
  {
    "id": "DA11",
    "x": 93.217828,
    "y": -81.242172
  },
  {
    "id": "DA12",
    "x": 90.405657,
    "y": -84.054343
  },
  {
    "id": "DA13",
    "x": 87.593486,
    "y": -86.866514
  },
  {
    "id": "DA14",
    "x": 84.781314,
    "y": -89.678686
  },
  {
    "id": "DA15",
    "x": 81.31,
    "y": -90.7
  },
  {
    "id": "DA16",
    "x": 77.27,
    "y": -90.7
  },
  {
    "id": "DA17",
    "x": 75.5,
    "y": -93.33
  },
  {
    "id": "DA18",
    "x": 75.5,
    "y": -97.363333
  },
  {
    "id": "DA19",
    "x": 75.5,
    "y": -101.396666
  },
  {
    "id": "DA20",
    "x": 75.5,
    "y": -105.43
  },
  {
    "id": "DA21",
    "x": 74.40967,
    "y": -108.44033
  },
  {
    "id": "DA22",
    "x": 71.21978,
    "y": -111.63022
  },
  {
    "id": "DA23",
    "x": 68.02989,
    "y": -114.82011
  },
  {
    "id": "DA24",
    "x": 64.84,
    "y": -118.01
  },
  {
    "id": "DA25",
    "x": 65.95,
    "y": -123.06
  },
  {
    "id": "DA26",
    "x": 66.39,
    "y": -128.04
  },
  {
    "id": "DA27",
    "x": 66.39,
    "y": -130.6
  },
  {
    "id": "DB1",
    "x": 103.4,
    "y": -70.475
  },
  {
    "id": "DB2",
    "x": 99.425,
    "y": -70.475
  },
  {
    "id": "DB3",
    "x": 95.45,
    "y": -70.475
  },
  {
    "id": "DB4",
    "x": 91.79,
    "y": -71.61
  },
  {
    "id": "DB5",
    "x": 86.19,
    "y": -73.04
  },
  {
    "id": "DB6",
    "x": 81.051472,
    "y": -72.007868
  },
  {
    "id": "DB7",
    "x": 79.54,
    "y": -68.61
  },
  {
    "id": "DB8",
    "x": 79.5275,
    "y": -64.235
  },
  {
    "id": "DB9",
    "x": 79.5275,
    "y": -59.71
  },
  {
    "id": "DB10",
    "x": 79.5275,
    "y": -55.36
  },
  {
    "id": "DB11",
    "x": 76.775,
    "y": -50.525
  },
  {
    "id": "DB12",
    "x": 74.002082,
    "y": -47.847918
  },
  {
    "id": "DB13",
    "x": 70.07,
    "y": -45.69
  },
  {
    "id": "DB14",
    "x": 65.773331,
    "y": -45.69
  },
  {
    "id": "DB15",
    "x": 61.476665,
    "y": -45.69
  },
  {
    "id": "DB16",
    "x": 57.179999,
    "y": -45.69
  },
  {
    "id": "DB17",
    "x": 52.883333,
    "y": -45.69
  },
  {
    "id": "DB18",
    "x": 48.586667,
    "y": -45.69
  },
  {
    "id": "DB19",
    "x": 44.29,
    "y": -45.69
  },
  {
    "id": "DB20",
    "x": 40.347919,
    "y": -46.047919
  },
  {
    "id": "DB21",
    "x": 38.608436,
    "y": -47.787401
  },
  {
    "id": "DB22",
    "x": 36.868953,
    "y": -49.526884
  },
  {
    "id": "DB23",
    "x": 35.129471,
    "y": -51.266367
  },
  {
    "id": "DB24",
    "x": 33.975,
    "y": -54.28
  },
  {
    "id": "DB25",
    "x": 33.945,
    "y": -56.78
  },
  {
    "id": "DB26",
    "x": 31.557919,
    "y": -61.757919
  },
  {
    "id": "DB27",
    "x": 29.677015,
    "y": -63.638823
  },
  {
    "id": "DB28",
    "x": 27.916319,
    "y": -65.399519
  },
  {
    "id": "DC1",
    "x": 41.63,
    "y": -52.98
  },
  {
    "id": "DC2",
    "x": 41.63,
    "y": -55.92
  },
  {
    "id": "DC3",
    "x": 40.36,
    "y": -60.06
  },
  {
    "id": "DC4",
    "x": 37.57,
    "y": -62.85
  },
  {
    "id": "DC5",
    "x": 34.565,
    "y": -65.855
  },
  {
    "id": "DC6",
    "x": 33.47,
    "y": -70.03
  },
  {
    "id": "DC7",
    "x": 34.977868,
    "y": -74.651472
  },
  {
    "id": "DC8",
    "x": 36.61,
    "y": -80.6
  },
  {
    "id": "DC9",
    "x": 36.61,
    "y": -83.63
  },
  {
    "id": "DC10",
    "x": 36.61,
    "y": -86.4
  },
  {
    "id": "DC11",
    "x": 36.61,
    "y": -89.11
  },
  {
    "id": "DC12",
    "x": 36.61,
    "y": -92.03
  },
  {
    "id": "DC13",
    "x": 37.63,
    "y": -94.698787
  },
  {
    "id": "DC14",
    "x": 39.455,
    "y": -96.523787
  },
  {
    "id": "DC15",
    "x": 41.27,
    "y": -98.338787
  },
  {
    "id": "DC16",
    "x": 43.13,
    "y": -100.198787
  },
  {
    "id": "DC17",
    "x": 44.65,
    "y": -102.84
  },
  {
    "id": "DC18",
    "x": 44.65,
    "y": -105.44
  },
  {
    "id": "DC19",
    "x": 45.812654,
    "y": -108.08905
  },
  {
    "id": "DC20",
    "x": 48.281472,
    "y": -110.557868
  },
  {
    "id": "DC21",
    "x": 51.326472,
    "y": -113.602868
  },
  {
    "id": "DC22",
    "x": 54.241472,
    "y": -116.517868
  },
  {
    "id": "DC23",
    "x": 57.086472,
    "y": -119.362868
  },
  {
    "id": "DC24",
    "x": 60.101472,
    "y": -122.377868
  },
  {
    "id": "DC25",
    "x": 62.981472,
    "y": -125.257868
  },
  {
    "id": "DC26",
    "x": 64.69,
    "y": -128.04
  },
  {
    "id": "DC27",
    "x": 64.69,
    "y": -130.62
  },
  {
    "id": "DC28",
    "x": 67.26,
    "y": -133.93
  },
  {
    "id": "DC29",
    "x": 70.477336,
    "y": -137.147336
  },
  {
    "id": "DC30",
    "x": 73.33,
    "y": -141.18
  },
  {
    "id": "DG1",
    "x": 79.51949,
    "y": -124.610628
  },
  {
    "id": "DG2",
    "x": 79.52,
    "y": -120.99
  },
  {
    "id": "DG3",
    "x": 79.52,
    "y": -117.315
  },
  {
    "id": "DG4",
    "x": 79.52,
    "y": -113.64
  },
  {
    "id": "DG5",
    "x": 79.52,
    "y": -109.965
  },
  {
    "id": "DG6",
    "x": 79.52,
    "y": -105.915
  },
  {
    "id": "DG7",
    "x": 79.52,
    "y": -101.865
  },
  {
    "id": "DG8",
    "x": 79.52,
    "y": -98.165
  },
  {
    "id": "DG9",
    "x": 79.52,
    "y": -94.465
  },
  {
    "id": "DG10",
    "x": 79.52,
    "y": -87.54
  },
  {
    "id": "DG11",
    "x": 79.52,
    "y": -81.115
  },
  {
    "id": "DG12",
    "x": 79.52,
    "y": -75.09
  },
  {
    "id": "DG13",
    "x": 77.815,
    "y": -68.61
  },
  {
    "id": "DG14",
    "x": 77.8275,
    "y": -64.235
  },
  {
    "id": "DG15",
    "x": 77.8275,
    "y": -59.71
  },
  {
    "id": "DG16",
    "x": 77.8275,
    "y": -55.36
  },
  {
    "id": "DG17",
    "x": 75.57658,
    "y": -51.730743
  },
  {
    "id": "DG18",
    "x": 70.07,
    "y": -47.39
  },
  {
    "id": "DG19",
    "x": 65.773331,
    "y": -47.39
  },
  {
    "id": "DG20",
    "x": 61.476665,
    "y": -47.39
  },
  {
    "id": "DG21",
    "x": 57.179999,
    "y": -47.39
  },
  {
    "id": "DG22",
    "x": 52.883333,
    "y": -47.39
  },
  {
    "id": "DG23",
    "x": 48.586667,
    "y": -47.39
  },
  {
    "id": "DG24",
    "x": 44.29,
    "y": -47.39
  },
  {
    "id": "DG25",
    "x": 41.55,
    "y": -47.25
  },
  {
    "id": "DG26",
    "x": 39.810518,
    "y": -48.989483
  },
  {
    "id": "DG27",
    "x": 38.071035,
    "y": -50.728966
  },
  {
    "id": "DG28",
    "x": 36.331552,
    "y": -52.468448
  },
  {
    "id": "DG29",
    "x": 36.065,
    "y": -54.68
  },
  {
    "id": "DG30",
    "x": 35.645,
    "y": -56.78
  },
  {
    "id": "DG31",
    "x": 32.76,
    "y": -62.96
  },
  {
    "id": "DG32",
    "x": 30.879096,
    "y": -64.840904
  },
  {
    "id": "DG33",
    "x": 29.1184,
    "y": -66.6016
  },
  {
    "id": "DG34",
    "x": 72.8,
    "y": -49.05
  },
  {
    "id": "DL1",
    "x": 94.605,
    "y": -94.18
  },
  {
    "id": "DL2",
    "x": 94.605,
    "y": -96.605
  },
  {
    "id": "DL3",
    "x": 94.605,
    "y": -99.03
  },
  {
    "id": "DL4",
    "x": 94.605,
    "y": -101.455
  },
  {
    "id": "DL5",
    "x": 94.605,
    "y": -103.88
  },
  {
    "id": "DL6",
    "x": 112.835914,
    "y": -91.74
  },
  {
    "id": "DL7",
    "x": 112.835914,
    "y": -98.58
  },
  {
    "id": "DO1",
    "x": 81.22051,
    "y": -124.615
  },
  {
    "id": "DO2",
    "x": 81.22,
    "y": -120.99
  },
  {
    "id": "DO3",
    "x": 81.22,
    "y": -117.315
  },
  {
    "id": "DO4",
    "x": 81.22,
    "y": -113.64
  },
  {
    "id": "DO5",
    "x": 81.22,
    "y": -109.965
  },
  {
    "id": "DO6",
    "x": 81.22,
    "y": -105.915
  },
  {
    "id": "DO7",
    "x": 81.22,
    "y": -101.865
  },
  {
    "id": "DO8",
    "x": 81.22,
    "y": -98.165
  },
  {
    "id": "DO9",
    "x": 81.22,
    "y": -94.465
  },
  {
    "id": "DO10",
    "x": 81.22,
    "y": -87.54
  },
  {
    "id": "DO11",
    "x": 81.22,
    "y": -81.115
  },
  {
    "id": "DO12",
    "x": 81.22,
    "y": -75.09
  },
  {
    "id": "DO13",
    "x": 81.24,
    "y": -68.61
  },
  {
    "id": "DO14",
    "x": 81.2275,
    "y": -64.235
  },
  {
    "id": "DO15",
    "x": 81.2275,
    "y": -59.71
  },
  {
    "id": "DO16",
    "x": 81.2275,
    "y": -55.36
  },
  {
    "id": "DO17",
    "x": 77.980743,
    "y": -49.32658
  },
  {
    "id": "DO18",
    "x": 76.275,
    "y": -45.525
  },
  {
    "id": "DO19",
    "x": 76.785,
    "y": -42.39
  },
  {
    "id": "DO20",
    "x": 76.79,
    "y": -39.92
  },
  {
    "id": "DO21",
    "x": 76.79,
    "y": -37.45
  },
  {
    "id": "DO22",
    "x": 75.08,
    "y": -33.76
  },
  {
    "id": "DO23",
    "x": 75.07,
    "y": -30.21
  },
  {
    "id": "DO24",
    "x": 73.74,
    "y": -26.36
  },
  {
    "id": "DO25",
    "x": 71.772816,
    "y": -24.417184
  },
  {
    "id": "DO26",
    "x": 69.488861,
    "y": -22.13323
  },
  {
    "id": "DO27",
    "x": 67.699881,
    "y": -20.344249
  },
  {
    "id": "DR1",
    "x": 66.497065,
    "y": -21.547065
  },
  {
    "id": "DR2",
    "x": 68.286046,
    "y": -23.336045
  },
  {
    "id": "DR3",
    "x": 70.57,
    "y": -25.62
  },
  {
    "id": "DR4",
    "x": 72.537185,
    "y": -27.562815
  },
  {
    "id": "DR5",
    "x": 73.37,
    "y": -30.21
  },
  {
    "id": "DR6",
    "x": 73.38,
    "y": -33.76
  },
  {
    "id": "DR7",
    "x": 73.38,
    "y": -37.45
  },
  {
    "id": "DR8",
    "x": 73.38,
    "y": -39.92
  },
  {
    "id": "DR9",
    "x": 73.385,
    "y": -42.39
  },
  {
    "id": "DR10",
    "x": 70.07,
    "y": -42.29
  },
  {
    "id": "DR11",
    "x": 65.773331,
    "y": -42.29
  },
  {
    "id": "DR12",
    "x": 61.476665,
    "y": -42.29
  },
  {
    "id": "DR13",
    "x": 57.179999,
    "y": -42.29
  },
  {
    "id": "DR14",
    "x": 52.883333,
    "y": -42.29
  },
  {
    "id": "DR15",
    "x": 48.586667,
    "y": -42.29
  },
  {
    "id": "DR16",
    "x": 44.29,
    "y": -42.29
  },
  {
    "id": "DR17",
    "x": 37.943756,
    "y": -43.643756
  },
  {
    "id": "DR18",
    "x": 36.204273,
    "y": -45.383238
  },
  {
    "id": "DR19",
    "x": 34.46479,
    "y": -47.122721
  },
  {
    "id": "DR20",
    "x": 32.725308,
    "y": -48.862204
  },
  {
    "id": "DR21",
    "x": 30.54,
    "y": -54.28
  },
  {
    "id": "DR22",
    "x": 30.54,
    "y": -56.78
  },
  {
    "id": "DR23",
    "x": 29.15564,
    "y": -59.351872
  },
  {
    "id": "DR24",
    "x": 27.272852,
    "y": -61.23466
  },
  {
    "id": "DR25",
    "x": 25.512156,
    "y": -62.995356
  },
  {
    "id": "DR26",
    "x": 23.95,
    "y": -66.95
  },
  {
    "id": "DR27",
    "x": 27.399817,
    "y": -72.650183
  },
  {
    "id": "DR28",
    "x": 31.385993,
    "y": -76.639007
  },
  {
    "id": "DR29",
    "x": 40.36,
    "y": -78.47
  },
  {
    "id": "DR30",
    "x": 38.31,
    "y": -80.61
  },
  {
    "id": "DY1",
    "x": 122.2,
    "y": -16.18
  },
  {
    "id": "DY2",
    "x": 115.22,
    "y": -16.18
  },
  {
    "id": "DY3",
    "x": 108.46,
    "y": -16.18
  },
  {
    "id": "DY4",
    "x": 105.002109,
    "y": -18.743731
  },
  {
    "id": "DY5",
    "x": 101.36,
    "y": -22.39
  },
  {
    "id": "DY6",
    "x": 98.197439,
    "y": -25.548401
  },
  {
    "id": "DY7",
    "x": 95.467439,
    "y": -28.278401
  },
  {
    "id": "DY8",
    "x": 92.427439,
    "y": -31.318401
  },
  {
    "id": "DY9",
    "x": 87.61,
    "y": -34.61
  },
  {
    "id": "DY10",
    "x": 83.72,
    "y": -34.61
  },
  {
    "id": "DY11",
    "x": 79.76,
    "y": -34.61
  },
  {
    "id": "DY12",
    "x": 75.08,
    "y": -37.45
  },
  {
    "id": "DY13",
    "x": 75.08,
    "y": -39.92
  },
  {
    "id": "DY14",
    "x": 75.085,
    "y": -42.39
  },
  {
    "id": "DY15",
    "x": 70.07,
    "y": -43.99
  },
  {
    "id": "DY16",
    "x": 65.773331,
    "y": -43.99
  },
  {
    "id": "DY17",
    "x": 61.476665,
    "y": -43.99
  },
  {
    "id": "DY18",
    "x": 57.179999,
    "y": -43.99
  },
  {
    "id": "DY19",
    "x": 52.883333,
    "y": -43.99
  },
  {
    "id": "DY20",
    "x": 48.586667,
    "y": -43.99
  },
  {
    "id": "DY21",
    "x": 44.29,
    "y": -43.99
  },
  {
    "id": "DY22",
    "x": 39.145837,
    "y": -44.845837
  },
  {
    "id": "DY23",
    "x": 37.406355,
    "y": -46.58532
  },
  {
    "id": "DY24",
    "x": 35.666872,
    "y": -48.324803
  },
  {
    "id": "DY25",
    "x": 33.927389,
    "y": -50.064285
  },
  {
    "id": "DY26",
    "x": 32.245,
    "y": -54.28
  },
  {
    "id": "DY27",
    "x": 32.245,
    "y": -56.78
  },
  {
    "id": "DY28",
    "x": 30.357721,
    "y": -60.553953
  },
  {
    "id": "DY29",
    "x": 28.474933,
    "y": -62.436741
  },
  {
    "id": "DY30",
    "x": 26.714237,
    "y": -64.197437
  },
  {
    "id": "DY31",
    "x": 25.66,
    "y": -66.96
  },
  {
    "id": "DY32",
    "x": 28.6,
    "y": -71.45
  },
  {
    "id": "DY33",
    "x": 32.588823,
    "y": -75.436176
  },
  {
    "id": "DY34",
    "x": 40.36,
    "y": -76.77
  }
];

const linePrefix = {
  0: 'DR', 1: 'DO', 2: 'DY', 3: 'DG',
  4: 'DB', 5: 'DC', 6: 'DA', 7: 'DL'
};

document.addEventListener('DOMContentLoaded', async () => {
  let resp = await fetch('https://gist.githack.com/MostOriginalIGN/9e108d50700c377a8a7282d805c6d780/raw/2791e95fb838cb7a6a8e38e71e03e8015c03b8c9/board.svg');
  if (!resp.ok) {
    console.error('Failed to fetch board.svg:', resp.status);
    return;
  }
  let svgText = await resp.text();

  const container = document.getElementById('svgContainer');
  container.innerHTML = svgText;

  const svg = container.querySelector('svg');
  if (!svg) {
    console.error('No <svg> found inside board.svg!');
    return;
  }

  const [vbMinX, vbMinY, vbW, vbH] =
    svg.getAttribute('viewBox').trim().split(/[\s,]+/).map(Number);

  const xs = leds.map(p => p.x), ys = leds.map(p => p.y);
  const minX = Math.min(...xs), maxX = Math.max(...xs);
  const minY = Math.min(...ys), maxY = Math.max(...ys);
  const dataW = maxX - minX, dataH = maxY - minY;

  const scaleX  = vbW  / dataW * 0.83;
  const scaleY  = vbH  / dataH * 0.87;
  const offsetX = vbMinX - minX * scaleX + 34;
  const offsetY = vbMinY - minY * scaleY + 41;

  const SVG_NS   = 'http://www.w3.org/2000/svg';
  const circleMap = {};

  leds.forEach(pt => {
    const x0 = pt.x * scaleX + offsetX;
    const y0 = pt.y * scaleY + offsetY;
    const cx = x0;
    const cy = vbMinY + vbH - (y0 - vbMinY);

    const c = document.createElementNS(SVG_NS, 'circle');
    c.setAttribute('cx',           cx);
    c.setAttribute('cy',           cy);
    c.setAttribute('r',            3);
    c.setAttribute('fill',         'rgba(50,50,50,0.3)');
    c.setAttribute('stroke',       'white');
    c.setAttribute('stroke-width', 1);
    c.dataset.id = pt.id;

    svg.appendChild(c);
    circleMap[pt.id] = c;
  });

  function applyLedJson(json) {
    json.leds.forEach(item => {
      const prefix = linePrefix[item.line];
      if (!prefix) return;
      const id = prefix + String(item.idx + 1);
      const c  = circleMap[id];
      if (!c) return;
      if (item.on) {
        c.setAttribute('fill', item.color || 'rgba(0,200,0,0.8)');
      } else {
        c.setAttribute('fill', 'rgba(50,50,50,0.3)');
      }
    });
  }

  async function updateStatuses() {
    try {
      const res  = await fetch('/leds');
      const body = await res.json();
      applyLedJson(body);
    } catch (err) {
      console.warn('LED status fetch failed:', err);
    }
  }

  updateStatuses();
  setInterval(updateStatuses, 2000);
});